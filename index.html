<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³„ì•½ì„œ ì‘ì„± ë° ì„œëª… ì•±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 0.9rem;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .tab.active {
            background: white;
            color: #4facfe;
            border-bottom: 3px solid #4facfe;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 40px;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            margin-bottom: 40px;
        }

        .form-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4facfe;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #4facfe;
        }

        .contract-preview {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 30px;
            line-height: 1.8;
            font-size: 0.95rem;
            max-height: 600px;
            overflow-y: auto;
        }

        .contract-title {
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }

        .contract-article {
            margin-bottom: 20px;
        }

        .article-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .contract-article .article-title {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .signature-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 40px;
        }

        .upload-box {
            border: 3px dashed #e0e0e0;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .upload-box:hover {
            border-color: #4facfe;
            background: rgba(79, 172, 254, 0.05);
            transform: translateY(-2px);
        }

        .upload-box.dragover {
            border-color: #00f2fe;
            background: rgba(0, 242, 254, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            color: #4facfe;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 1.2rem;
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .upload-subtext {
            color: #666;
            font-size: 0.9rem;
        }

        input[type="file"] {
            display: none;
        }

        .workspace {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            min-height: 600px;
            position: relative;
            background: white;
            overflow: hidden;
            margin-top: 20px;
        }

        .document-canvas {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: auto;
            padding: 20px;
        }

        .contract-document {
            background: white;
            padding: 40px;
            line-height: 1.8;
            font-size: 0.9rem;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-radius: 10px;
        }

        .signature-overlay {
            position: absolute;
            cursor: move;
            border: 2px dashed transparent;
            border-radius: 5px;
            transition: border-color 0.3s ease;
        }

        .signature-overlay:hover {
            border-color: #4facfe;
        }

        .signature-overlay.selected {
            border-color: #00f2fe;
        }

        .signature-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .slider {
            width: 150px;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4facfe;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #e0e0e0;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .btn-large {
            padding: 16px 32px;
            font-size: 1.1rem;
            margin: 20px 0;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 500;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.processing {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .hidden {
            display: none;
        }

        .signature-placeholder {
            background: #e3f2fd;
            border: 2px dashed #2196f3;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin: 10px 0;
            color: #1976d2;
            font-weight: 600;
        }

        .checklist-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .checklist-item:last-child {
            border-bottom: none;
        }

        .status-pending {
            color: #ff9800;
            font-weight: 600;
        }

        .status-complete {
            color: #4caf50;
            font-weight: 600;
        }

        .receipt-title {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 30px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }

        .receipt-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .receipt-table th,
        .receipt-table td {
            border: 1px solid #333;
            padding: 12px;
            text-align: left;
        }

        .receipt-table th {
            background: #f5f5f5;
            font-weight: bold;
            text-align: center;
        }

        .receipt-note {
            margin-top: 30px;
            font-size: 0.9rem;
            color: #666;
        }

        .contract-editor {
            margin-bottom: 30px;
        }

        .contract-template {
            width: 100%;
            min-height: 400px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.9rem;
            line-height: 1.6;
            resize: vertical;
        }

        .contract-template:focus {
            outline: none;
            border-color: #4facfe;
        }

        @media print {
            @page {
                size: A4;
                margin: 15mm;
            }
            
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            body {
                background: white !important;
                font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif !important;
                color: black !important;
                line-height: 1.6 !important;
                font-size: 11pt !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .container {
                box-shadow: none !important;
                border-radius: 0 !important;
                background: white !important;
                max-width: none !important;
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
            }
            
            .header, .tabs, .controls, .status, .btn, .signature-section {
                display: none !important;
            }
            
            .workspace {
                border: none !important;
                box-shadow: none !important;
                overflow: visible !important;
                height: auto !important;
                margin: 0 !important;
                position: static !important;
            }
            
            .document-canvas {
                padding: 0 !important;
                overflow: visible !important;
                position: static !important;
                height: auto !important;
                width: 100% !important;
            }
            
            .contract-document {
                box-shadow: none !important;
                border-radius: 0 !important;
                padding: 0 !important;
                max-width: none !important;
                margin: 0 !important;
                position: static !important;
                width: 100% !important;
            }
            
            .signature-overlay {
                position: static !important;
                display: inline-block !important;
                border: none !important;
                transform: none !important;
                left: auto !important;
                top: auto !important;
                margin: 0 !important;
                padding: 0 !important;
                vertical-align: middle !important;
                page-break-inside: avoid !important;
            }
            
            .signature-overlay img {
                max-width: 80px !important;
                max-height: 40px !important;
                width: auto !important;
                height: auto !important;
                display: inline-block !important;
                vertical-align: middle !important;
            }
            
            .tab-content {
                display: none !important;
                padding: 0 !important;
            }
            
            #signatureTab.active,
            #previewTab.active {
                display: block !important;
                padding: 0 !important;
            }
            
            #signatureTab.active .signature-section,
            #signatureTab.active .controls {
                display: none !important;
            }
            
            table {
                page-break-inside: avoid !important;
                border-collapse: collapse !important;
                width: 100% !important;
            }
            
            td, th {
                border: 1px solid #000 !important;
                padding: 6px !important;
                font-size: 10pt !important;
                vertical-align: middle !important;
            }
            
            .signature-placeholder {
                min-height: 35px !important;
                border: 1px solid #ccc !important;
                background: white !important;
                padding: 5px !important;
                text-align: center !important;
                vertical-align: middle !important;
            }
            
            .contract-title {
                font-size: 14pt !important;
                font-weight: bold !important;
                text-align: center !important;
                margin-bottom: 20px !important;
            }
            
            .contract-article {
                font-size: 10pt !important;
                line-height: 1.5 !important;
                margin-bottom: 15px !important;
            }
        }

        @media (max-width: 768px) {
            .signature-section {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .control-group {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ ê³„ì•½ì„œ ì‘ì„± ë° ì„œëª…</h1>
            <p>ê³„ì•½ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ì„œëª…ì„ ì™„ë£Œí•˜ì„¸ìš”</p>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="info">ğŸ“‹ ê³„ì•½ ì •ë³´ ì…ë ¥</button>
            <button class="tab" data-tab="template">ğŸ“ ê³„ì•½ì„œ í…œí”Œë¦¿ í¸ì§‘</button>
            <button class="tab" data-tab="signature">âœï¸ ì„œëª… ì§„í–‰</button>
            <button class="tab" data-tab="preview">ğŸ“„ ì™„ì„±ëœ ê³„ì•½ì„œ</button>
            <button class="tab" data-tab="receipt">ğŸ§¾ ì˜ìˆ˜ì¦ ìƒì„±</button>
            <button class="tab" data-tab="export">ğŸ”— ì „ì†¡ìš© ë§í¬ ìƒì„±</button>
        </div>

        <!-- ê³„ì•½ ì •ë³´ ì…ë ¥ íƒ­ -->
        <div id="infoTab" class="tab-content active">
            <div class="form-section">
                <div class="form-title">ê¸°ë³¸ ì •ë³´</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>í–‰ì‚¬ëª…</label>
                        <input type="text" id="eventName" value="2025ë…„ì— ì„ì² ë¯¼ ë³´ê¸°: ê³¨_ë“ _ë¼_ì´_íŠ¸">
                    </div>
                    <div class="form-group">
                        <label>í–‰ì‚¬ ì¥ì†Œ</label>
                        <input type="text" id="venue" value="í‚¤ë‹ˆë§ˆ(ì„œìš¸ì‹œ ë§ˆí¬êµ¬ ëŒ€í¥ë¡œ2ê¸¸ 5, 202í˜¸">
                    </div>
                    <div class="form-group">
                        <label>í–‰ì‚¬ ì‹œì‘ì¼</label>
                        <input type="date" id="startDate" value="2025-06-12">
                    </div>
                    <div class="form-group">
                        <label>í–‰ì‚¬ ì¢…ë£Œì¼</label>
                        <input type="date" id="endDate" value="2025-06-29">
                    </div>
                    <div class="form-group">
                        <label>ì—­í• </label>
                        <input type="text" id="role" value="íŠ¹ë³„ì „ ê°ë…">
                    </div>
                    <div class="form-group">
                        <label>ë‚´ìš©</label>
                        <input type="text" id="content" value="ì‘í’ˆ ìƒì˜ ë° ëŒ€ë‹´ ì°¸ì„">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="form-title">ê³„ì•½ ëŒ€ê¸ˆ</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>ì´ ì‚¬ë¡€ê¸ˆ (ì›)</label>
                        <input type="text" id="totalAmount" value="500,000">
                    </div>
                    <div class="form-group">
                        <label>ì„¸ê¸ˆë¥  (%)</label>
                        <input type="number" id="taxRate" value="3.3" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>ì„¸ê¸ˆ (ì›)</label>
                        <input type="text" id="taxAmount" value="16,500" readonly>
                    </div>
                    <div class="form-group">
                        <label>ì‹¤ìˆ˜ë ¹ì•¡ (ì›)</label>
                        <input type="text" id="netAmount" value="483,500" readonly>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="form-title">ë‹¹ì‚¬ì ì •ë³´</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>ê°‘ (ë‹¨ì²´ëª…)</label>
                        <input type="text" id="partyA" value="í‚¤ë‹ˆë§ˆ">
                    </div>
                    <div class="form-group">
                        <label>ê°‘ ëŒ€í‘œì</label>
                        <input type="text" id="representativeA" value="ê¹€ë‚˜ì˜">
                    </div>
                    <div class="form-group">
                        <label>ê°‘ ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</label>
                        <input type="text" id="businessNumber" value="407-17-02376">
                    </div>
                    <div class="form-group">
                        <label>ê°‘ ì—°ë½ì²˜</label>
                        <input type="text" id="contactA" value="010-2710-3297">
                    </div>
                    <div class="form-group">
                        <label>ê°‘ ì†Œì¬ì§€</label>
                        <input type="text" id="addressA" value="ì„œìš¸ì‹œ ë§ˆí¬êµ¬ ëŒ€í¥ë¡œ2ê¸¸ 5, 202í˜¸">
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>ì„ (ê°œì¸ëª…)</label>
                        <input type="text" id="partyB" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label>ì„ ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸</label>
                        <input type="text" id="idNumber" placeholder="ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label>ì„ ì—°ë½ì²˜</label>
                        <input type="text" id="contactB" placeholder="ì—°ë½ì²˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label>ì„ ì£¼ì†Œ</label>
                        <input type="text" id="addressB" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="form-title">ë¶„ìŸ í•´ê²° ë°©ì‹</div>
                <div class="form-group">
                    <label>ë¶„ìŸ í•´ê²° ë°©ì‹ì„ ì„ íƒí•˜ì„¸ìš”:</label>
                    <div style="margin-top: 15px;">
                        <div style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 15px;">
                            <input type="radio" id="arbitration" name="dispute" value="arbitration" style="width: auto; margin-top: 2px; flex-shrink: 0;">
                            <label for="arbitration" style="font-weight: normal; margin-bottom: 0; cursor: pointer;">ì¤‘ì¬ë²•ì— ë”°ë¼ ì„¤ì¹˜ëœ ëŒ€í•œìƒì‚¬ì¤‘ì¬ì›ì˜ ì¤‘ì¬</label>
                        </div>
                        <div style="display: flex; align-items: flex-start; gap: 10px;">
                            <input type="radio" id="court" name="dispute" value="court" style="width: auto; margin-top: 2px; flex-shrink: 0;">
                            <label for="court" style="font-weight: normal; margin-bottom: 0; cursor: pointer;">ë¯¼ì‚¬ì†Œì†¡ë²•ì— ë”°ë¥¸ ë²•ì›ì—ì„œì˜ ì†Œì†¡. ì´ ê²½ìš° ì œ1ì‹¬ ê´€í• ë²•ì›ì€ ê°‘ì´ ì†Œì¬í•œ ì§€ì—­ì˜ ì§€ë°©ë²•ì›ìœ¼ë¡œ í•œë‹¤.</label>
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary btn-large" onclick="showTab('signature')">âœï¸ ì„œëª… ì§„í–‰í•˜ê¸°</button>
        </div>

        <!-- ê³„ì•½ì„œ í…œí”Œë¦¿ í¸ì§‘ íƒ­ -->
        <div id="templateTab" class="tab-content">
            <div class="form-section">
                <div class="form-title">ê³„ì•½ì„œ í…œí”Œë¦¿ í¸ì§‘</div>
                <p style="margin-bottom: 20px; color: #666;">
                    ì•„ë˜ í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ í¸ì§‘í•˜ì—¬ ê³„ì•½ì„œ ë‚´ìš©ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
                    {{ë³€ìˆ˜ëª…}} í˜•íƒœë¡œ ëœ ë¶€ë¶„ì€ ìë™ìœ¼ë¡œ ì…ë ¥ëœ ì •ë³´ë¡œ ì¹˜í™˜ë©ë‹ˆë‹¤.
                </p>
                
                <div class="contract-editor">
                    <textarea id="contractTemplate" class="contract-template" placeholder="ê³„ì•½ì„œ í…œí”Œë¦¿ì„ ì…ë ¥í•˜ì„¸ìš”...">
<{{eventName}}> {{role}} ê³„ì•½ì„œ

ìƒì˜ì {{partyA}} (ì´í•˜ ê°‘ì´ë¼ í•¨)ì™€ {{role}} {{partyB}}(ì´í•˜ ì„ì´ë¼ í•¨)ì€ ë‹¤ìŒê³¼ ê°™ì´ <{{eventName}}>(ì´í•˜ "í–‰ì‚¬"ë¼ í•¨)ì™€ ê´€ë ¨í•œ ê³„ì•½ì„ ì²´ê²°í•œë‹¤.

ì œ1ì¡° ê³„ì•½ëª©ì 
ë³¸ ê³„ì•½ì€ <{{eventName}}> {{content}}ì— ìˆì–´ ê°‘ê³¼ ì„ ì‚¬ì´ì˜ ê¶Œë¦¬ì™€ ì˜ë¬´ë¥¼ ëª…í™•íˆ í•˜ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ í•œë‹¤.

ì œ2ì¡° ê³„ì•½ê°œìš”
â‘  ë³¸ ê³„ì•½ì˜ ëŒ€ìƒì´ ë˜ëŠ” í–‰ì‚¬ì˜ ê°œìš”ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

1. ëª…ì¹­: <{{eventName}}>
2. ì¼ì •: {{startDate}} - {{endDate}}
3. ì¥ì†Œ: {{venue}}
4. ì£¼ìµœ: {{partyA}}
5. ë‚´ìš©: {{content}}

â‘¡ ì„ì€ ìƒê¸°í•œ í–‰ì‚¬ì˜ ì¼ì • ë‚´ {{role}}ìœ¼ë¡œ ì°¸ì—¬í•˜ë©° ì„¸ë¶€ì‚¬í•­ì€ ê°‘ê³¼ ì„ì˜ í•©ì˜ì— ë”°ë¼ ê²°ì •í•œë‹¤.

ì œ3ì¡° ê³„ì•½ê¸°ê°„
ë³¸ ê³„ì•½ì˜ ê¸°ê°„ì€ {{startDate}} - {{endDate}}ìœ¼ë¡œ í•œë‹¤.

ì œ4ì¡° ìƒì˜ì˜ í—ˆë½
ê°‘ì€ ì„ì—ê²Œ ê³„ì•½ì— ë”°ë¼ ì§€ì •ëœ ì‘í’ˆ(ì´í•˜ 'ê³„ì•½ ì‘í’ˆ'ì´ë¼ í•œë‹¤)ë¥¼ ì§€ì •ëœ ì¥ì†Œì—ì„œ ì§€ì •ëœ ì¼ìˆ˜ë§Œí¼ ê³µê°œ ìƒì˜í•  ê¶Œë¦¬ë¥¼ ë¶€ì—¬í•˜ë©°, ê°‘ì€ ê³„ì•½ ì‘í’ˆì„ ê³„ì•½ì—ì„œ ì •í•œ ì¡°ê±´ ì™¸ì— ë‹¤ë¥¸ ì‹œê°„ì´ë‚˜ ì¥ì†Œ, ë‹¤ë¥¸ í˜•íƒœì˜ ì‚¬ìš© ë˜ëŠ” ë‹¤ë¥¸ ëª©ì ìœ¼ë¡œ ì´ìš©í•  ìˆ˜ ì—†ë‹¤.

ì œ5ì¡° ê³„ì•½ëŒ€ê¸ˆ
â‘  ê°‘ì€ ì„ì—ê²Œ ìƒì˜ë£Œ ë° ëŒ€ë‹´ ì°¸ì„ì— ëŒ€í•œ ì´ ì‚¬ë¡€ë¡œ ê¸ˆ {{totalAmountKorean}}ì› ({{totalAmountFormatted}})ì„ ë²•ë ¹ìƒì˜ ì„¸ê¸ˆ(3.3%) ê¸ˆ {{taxAmountKorean}}ì› ({{taxAmountFormatted}})ì„ ê³µì œí•œ í›„ ë‹¤ìŒì˜ ê¸°ì¤€ì— ë”°ë¼ ì§€ê¸‰í•œë‹¤.
                    </textarea>
                </div>
                
                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="color: #1976d2; margin-bottom: 10px;">ğŸ“ ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜ë“¤:</h4>
                    <div style="font-size: 0.9rem; color: #333; line-height: 1.6;">
                        {{eventName}}, {{venue}}, {{startDate}}, {{endDate}}, {{role}}, {{content}}, 
                        {{totalAmount}}, {{totalAmountKorean}}, {{totalAmountFormatted}}, 
                        {{taxAmount}}, {{taxAmountKorean}}, {{taxAmountFormatted}},
                        {{partyA}}, {{representativeA}}, {{businessNumber}}, {{partyB}}, {{idNumber}}
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="saveTemplate()">ğŸ’¾ í…œí”Œë¦¿ ì €ì¥</button>
                <button class="btn btn-secondary" onclick="resetTemplate()">ğŸ”„ ê¸°ë³¸ í…œí”Œë¦¿ìœ¼ë¡œ ë³µì›</button>
            </div>
        </div>

        <!-- ì™„ì„±ëœ ê³„ì•½ì„œ íƒ­ -->
        <div id="previewTab" class="tab-content">
            <div id="contractPreview" class="contract-preview">
                <!-- ê³„ì•½ì„œ ë‚´ìš©ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
            <button class="btn btn-primary btn-large" onclick="downloadPDF()">ğŸ“„ ê³„ì•½ì„œ PDF ë‹¤ìš´ë¡œë“œ</button>
        </div>

        <!-- ì„œëª… ë° ì™„ë£Œ íƒ­ -->
        <div id="signatureTab" class="tab-content">
            <div id="statusMessage" class="status hidden"></div>
            
            <div class="signature-section">
                <div class="upload-box" id="signatureUploadA">
                    <div class="upload-icon">âœï¸</div>
                    <div class="upload-text">ê°‘ ì„œëª… ì—…ë¡œë“œ</div>
                    <div class="upload-subtext">JPG, PNG íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</div>
                    <input type="file" id="signatureFileA" accept=".jpg,.jpeg,.png">
                </div>

                <div class="upload-box" id="signatureUploadB">
                    <div class="upload-icon">âœï¸</div>
                    <div class="upload-text">ì„ ì„œëª… ì—…ë¡œë“œ</div>
                    <div class="upload-subtext">JPG, PNG íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</div>
                    <input type="file" id="signatureFileB" accept=".jpg,.jpeg,.png">
                </div>
            </div>

            <div class="workspace" id="workspace">
                <div class="document-canvas" id="documentCanvas">
                    <div id="finalContract" class="contract-document">
                        <!-- ìµœì¢… ê³„ì•½ì„œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>ì„œëª… í¬ê¸°:</label>
                    <input type="range" id="sizeSlider" class="slider" min="50" max="200" value="120">
                    <span id="sizeValue">120px</span>
                </div>
                
                <div class="control-group">
                    <label>íˆ¬ëª…ë„:</label>
                    <input type="range" id="opacitySlider" class="slider" min="10" max="100" value="100">
                    <span id="opacityValue">100%</span>
                </div>

                <button class="btn btn-secondary" id="removeBackground">ë°°ê²½ ì œê±°</button>
                <button class="btn btn-primary" id="downloadPdfBtn">ğŸ“„ ì™„ì„±ëœ ê³„ì•½ì„œ ë³´ê¸°</button>
            </div>
        </div>

        <!-- ì˜ìˆ˜ì¦ ìƒì„± íƒ­ -->
        <div id="receiptTab" class="tab-content">
            <div class="form-section">
                <div class="form-title">ì˜ìˆ˜ì¦ ì •ë³´</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>ì…ê¸ˆì€í–‰</label>
                        <input type="text" id="bankName" placeholder="ì€í–‰ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label>ê³„ì¢Œë²ˆí˜¸</label>
                        <input type="text" id="accountNumber" placeholder="ê³„ì¢Œë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label>ì˜ˆê¸ˆì£¼ ì„±ëª…</label>
                        <input type="text" id="accountHolder" placeholder="ì˜ˆê¸ˆì£¼ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸</label>
                        <input type="text" id="accountHolderID" placeholder="ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label>ì£¼ì†Œ</label>
                        <input type="text" id="accountHolderAddress" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label>ì „í™”ë²ˆí˜¸</label>
                        <input type="text" id="accountHolderPhone" placeholder="ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                </div>
            </div>

            <div id="receiptPreview" class="contract-preview">
                <!-- ì˜ìˆ˜ì¦ ë‚´ìš©ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>

            <button class="btn btn-primary btn-large" onclick="generateReceipt()">ğŸ§¾ ì˜ìˆ˜ì¦ ìƒì„±</button>
            <button class="btn btn-primary" onclick="downloadReceiptPDF()">ğŸ“„ ì˜ìˆ˜ì¦ PDF ë‹¤ìš´ë¡œë“œ</button>
        </div>

        <!-- ì „ì†¡ìš© íŒŒì¼ ìƒì„± íƒ­ -->
        <div id="exportTab" class="tab-content">
            <div class="form-section">
                <div class="form-title">ì „ì†¡ìš© íŒŒì¼ ìƒì„±</div>
                <p style="margin-bottom: 30px; color: #666; line-height: 1.6;">
                    ë³¸ì¸(ê°‘)ì˜ ì„œëª…ì´ í¬í•¨ëœ HTML íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ìƒëŒ€ë°©(ì„)ì—ê²Œ ì „ì†¡í•˜ì„¸ìš”.<br>
                    ìƒëŒ€ë°©ì€ ë³¸ì¸ì˜ ì •ë³´ì™€ ì„œëª…ë§Œ ì¶”ê°€í•˜ë©´ ê³„ì•½ì´ ì™„ë£Œë©ë‹ˆë‹¤.
                </p>
                
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                    <h3 style="color: #1976d2; margin-bottom: 15px;">âœ… í™•ì¸ì‚¬í•­</h3>
                    <div id="exportChecklist">
                        <div class="checklist-item" id="checkContract">ğŸ“‹ ê³„ì•½ ì •ë³´ ì…ë ¥: <span class="status-pending">ëŒ€ê¸°ì¤‘</span></div>
                        <div class="checklist-item" id="checkSignatureA">âœï¸ ê°‘(ë³¸ì¸) ì„œëª…: <span class="status-pending">ëŒ€ê¸°ì¤‘</span></div>
                    </div>
                </div>

                <button class="btn btn-primary btn-large" id="generateExportFile" onclick="generateExportFile()" disabled>
                    ğŸ“¤ ìƒëŒ€ë°© ì „ì†¡ìš© HTML íŒŒì¼ ìƒì„±
                </button>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let signatureDataA = null;
        let signatureDataB = null;
        let currentSignatureA = null;
        let currentSignatureB = null;
        let selectedSignature = null;
        let customTemplate = null;

        // ê¸°ë³¸ í…œí”Œë¦¿
        const defaultTemplate = `<{{eventName}}> {{role}} ê³„ì•½ì„œ

ìƒì˜ì {{partyA}} (ì´í•˜ ê°‘ì´ë¼ í•¨)ì™€ {{role}} {{partyB}}(ì´í•˜ ì„ì´ë¼ í•¨)ì€ ë‹¤ìŒê³¼ ê°™ì´ <{{eventName}}>(ì´í•˜ "í–‰ì‚¬"ë¼ í•¨)ì™€ ê´€ë ¨í•œ ê³„ì•½ì„ ì²´ê²°í•œë‹¤.

ì œ1ì¡° ê³„ì•½ëª©ì 
ë³¸ ê³„ì•½ì€ <{{eventName}}> {{content}}ì— ìˆì–´ ê°‘ê³¼ ì„ ì‚¬ì´ì˜ ê¶Œë¦¬ì™€ ì˜ë¬´ë¥¼ ëª…í™•íˆ í•˜ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ í•œë‹¤.

ì œ2ì¡° ê³„ì•½ê°œìš”
â‘  ë³¸ ê³„ì•½ì˜ ëŒ€ìƒì´ ë˜ëŠ” í–‰ì‚¬ì˜ ê°œìš”ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

1. ëª…ì¹­: <{{eventName}}>
2. ì¼ì •: {{startDate}} - {{endDate}}
3. ì¥ì†Œ: {{venue}}
4. ì£¼ìµœ: {{partyA}}
5. ë‚´ìš©: {{content}}

â‘¡ ì„ì€ ìƒê¸°í•œ í–‰ì‚¬ì˜ ì¼ì • ë‚´ {{role}}ìœ¼ë¡œ ì°¸ì—¬í•˜ë©° ì„¸ë¶€ì‚¬í•­ì€ ê°‘ê³¼ ì„ì˜ í•©ì˜ì— ë”°ë¼ ê²°ì •í•œë‹¤.

ì œ3ì¡° ê³„ì•½ê¸°ê°„
ë³¸ ê³„ì•½ì˜ ê¸°ê°„ì€ {{startDate}} - {{endDate}}ìœ¼ë¡œ í•œë‹¤.

ì œ4ì¡° ìƒì˜ì˜ í—ˆë½
ê°‘ì€ ì„ì—ê²Œ ê³„ì•½ì— ë”°ë¼ ì§€ì •ëœ ì‘í’ˆ(ì´í•˜ 'ê³„ì•½ ì‘í’ˆ'ì´ë¼ í•œë‹¤)ë¥¼ ì§€ì •ëœ ì¥ì†Œì—ì„œ ì§€ì •ëœ ì¼ìˆ˜ë§Œí¼ ê³µê°œ ìƒì˜í•  ê¶Œë¦¬ë¥¼ ë¶€ì—¬í•˜ë©°, ê°‘ì€ ê³„ì•½ ì‘í’ˆì„ ê³„ì•½ì—ì„œ ì •í•œ ì¡°ê±´ ì™¸ì— ë‹¤ë¥¸ ì‹œê°„ì´ë‚˜ ì¥ì†Œ, ë‹¤ë¥¸ í˜•íƒœì˜ ì‚¬ìš© ë˜ëŠ” ë‹¤ë¥¸ ëª©ì ìœ¼ë¡œ ì´ìš©í•  ìˆ˜ ì—†ë‹¤.

ì œ5ì¡° ê³„ì•½ëŒ€ê¸ˆ
â‘  ê°‘ì€ ì„ì—ê²Œ ìƒì˜ë£Œ ë° ëŒ€ë‹´ ì°¸ì„ì— ëŒ€í•œ ì´ ì‚¬ë¡€ë¡œ ê¸ˆ {{totalAmountKorean}}ì› ({{totalAmountFormatted}})ì„ ë²•ë ¹ìƒì˜ ì„¸ê¸ˆ(3.3%) ê¸ˆ {{taxAmountKorean}}ì› ({{taxAmountFormatted}})ì„ ê³µì œí•œ í›„ ë‹¤ìŒì˜ ê¸°ì¤€ì— ë”°ë¼ ì§€ê¸‰í•œë‹¤.`;

        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(function(content) {
                content.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(function(tab) {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            document.querySelector('[data-tab="' + tabName + '"]').classList.add('active');
            
            if (tabName === 'signature') {
                generateFinalContract();
                setTimeout(() => {
                    if (signatureDataA) enableSignaturePlacement('A');
                    if (signatureDataB) enableSignaturePlacement('B');
                }, 100);
            } else if (tabName === 'export') {
                updateChecklist();
            } else if (tabName === 'receipt') {
                updateReceiptFields();
            } else if (tabName === 'preview') {
                updatePreview();
            }
        }

        // í…œí”Œë¦¿ ì €ì¥
        function saveTemplate() {
            customTemplate = document.getElementById('contractTemplate').value;
            showStatus('í…œí”Œë¦¿ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // í…œí”Œë¦¿ ì´ˆê¸°í™”
        function resetTemplate() {
            document.getElementById('contractTemplate').value = defaultTemplate;
            customTemplate = null;
            showStatus('ê¸°ë³¸ í…œí”Œë¦¿ìœ¼ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // ìˆ«ì í¬ë§·íŒ… í•¨ìˆ˜
        function formatNumber(num) {
            return parseInt(num).toLocaleString();
        }

        function unformatNumber(str) {
            return str.replace(/,/g, '');
        }

        // ê¸ˆì•¡ ê³„ì‚°
        function calculateAmounts() {
            const totalAmountInput = document.getElementById('totalAmount');
            const taxRateInput = document.getElementById('taxRate');
            const taxAmountInput = document.getElementById('taxAmount');
            const netAmountInput = document.getElementById('netAmount');
            
            const totalAmount = parseFloat(unformatNumber(totalAmountInput.value)) || 0;
            const taxRate = parseFloat(taxRateInput.value) || 0;
            const taxAmount = Math.round(totalAmount * taxRate / 100);
            const netAmount = totalAmount - taxAmount;
            
            taxAmountInput.value = formatNumber(taxAmount);
            netAmountInput.value = formatNumber(netAmount);
        }

        // ê³„ì•½ì„œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updatePreview() {
            const contractHtml = generateContractHtml();
            document.getElementById('contractPreview').innerHTML = contractHtml;
            showTab('preview');
        }

        // ë³€ìˆ˜ ì¹˜í™˜ í•¨ìˆ˜
        function replaceVariables(template) {
            const eventName = document.getElementById('eventName').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const venue = document.getElementById('venue').value;
            const role = document.getElementById('role').value;
            const content = document.getElementById('content').value;
            const totalAmount = document.getElementById('totalAmount').value;
            const taxAmount = document.getElementById('taxAmount').value;
            const partyA = document.getElementById('partyA').value;
            const representativeA = document.getElementById('representativeA').value;
            const businessNumber = document.getElementById('businessNumber').value;
            const contactA = document.getElementById('contactA').value;
            const addressA = document.getElementById('addressA').value;
            const partyB = document.getElementById('partyB').value;
            const idNumber = document.getElementById('idNumber').value;
            const contactB = document.getElementById('contactB').value;
            const addressB = document.getElementById('addressB').value;
            
            const totalAmountKorean = numberToKorean(unformatNumber(totalAmount));
            const taxAmountKorean = numberToKorean(unformatNumber(taxAmount));
            const totalAmountFormatted = parseInt(unformatNumber(totalAmount)).toLocaleString();
            const taxAmountFormatted = parseInt(unformatNumber(taxAmount)).toLocaleString();

            const disputeMethod = document.querySelector('input[name="dispute"]:checked');
            let disputeClause = '';
            if (disputeMethod) {
                if (disputeMethod.value === 'arbitration') {
                    disputeClause = 'ë³¸ ê³„ì•½ê³¼ ê´€ë ¨í•˜ì—¬ ë¶„ìŸì´ ë°œìƒí•œ ê²½ìš°ì—ëŠ” ì¤‘ì¬ë²•ì— ë”°ë¼ ì„¤ì¹˜ëœ ëŒ€í•œìƒì‚¬ì¤‘ì¬ì›ì˜ ì¤‘ì¬ì— ì˜í•˜ì—¬ í•´ê²°í•œë‹¤.';
                } else if (disputeMethod.value === 'court') {
                    disputeClause = 'ë³¸ ê³„ì•½ê³¼ ê´€ë ¨í•˜ì—¬ ë¶„ìŸì´ ë°œìƒí•œ ê²½ìš°ì—ëŠ” ë¯¼ì‚¬ì†Œì†¡ë²•ì— ë”°ë¥¸ ë²•ì›ì—ì„œì˜ ì†Œì†¡ì— ì˜í•˜ì—¬ í•´ê²°í•˜ë©°, ì œ1ì‹¬ ê´€í• ë²•ì›ì€ ê°‘ì´ ì†Œì¬í•œ ì§€ì—­ì˜ ì§€ë°©ë²•ì›ìœ¼ë¡œ í•œë‹¤.';
                }
            }

            return template
                .replace(/\{\{eventName\}\}/g, eventName)
                .replace(/\{\{startDate\}\}/g, startDate)
                .replace(/\{\{endDate\}\}/g, endDate)
                .replace(/\{\{venue\}\}/g, venue)
                .replace(/\{\{role\}\}/g, role)
                .replace(/\{\{content\}\}/g, content)
                .replace(/\{\{totalAmount\}\}/g, totalAmount)
                .replace(/\{\{totalAmountKorean\}\}/g, totalAmountKorean)
                .replace(/\{\{totalAmountFormatted\}\}/g, totalAmountFormatted)
                .replace(/\{\{taxAmount\}\}/g, taxAmount)
                .replace(/\{\{taxAmountKorean\}\}/g, taxAmountKorean)
                .replace(/\{\{taxAmountFormatted\}\}/g, taxAmountFormatted)
                .replace(/\{\{partyA\}\}/g, partyA)
                .replace(/\{\{representativeA\}\}/g, representativeA)
                .replace(/\{\{businessNumber\}\}/g, businessNumber)
                .replace(/\{\{contactA\}\}/g, contactA)
                .replace(/\{\{addressA\}\}/g, addressA)
                .replace(/\{\{partyB\}\}/g, partyB)
                .replace(/\{\{idNumber\}\}/g, idNumber)
                .replace(/\{\{contactB\}\}/g, contactB)
                .replace(/\{\{addressB\}\}/g, addressB)
                .replace(/\{\{disputeClause\}\}/g, disputeClause);
        }

        // ê³„ì•½ì„œ HTML ìƒì„±
        function generateContractHtml() {
            const template = customTemplate || defaultTemplate;
            let processedContent = replaceVariables(template);
            
            const disputeMethod = document.querySelector('input[name="dispute"]:checked');
            if (disputeMethod) {
                let disputeClause = '';
                if (disputeMethod.value === 'arbitration') {
                    disputeClause = '\n\nì œ6ì¡° ë¶„ìŸí•´ê²°\në³¸ ê³„ì•½ê³¼ ê´€ë ¨í•˜ì—¬ ë¶„ìŸì´ ë°œìƒí•œ ê²½ìš°ì—ëŠ” ì¤‘ì¬ë²•ì— ë”°ë¼ ì„¤ì¹˜ëœ ëŒ€í•œìƒì‚¬ì¤‘ì¬ì›ì˜ ì¤‘ì¬ì— ì˜í•˜ì—¬ í•´ê²°í•œë‹¤.';
                } else if (disputeMethod.value === 'court') {
                    disputeClause = '\n\nì œ6ì¡° ë¶„ìŸí•´ê²°\në³¸ ê³„ì•½ê³¼ ê´€ë ¨í•˜ì—¬ ë¶„ìŸì´ ë°œìƒí•œ ê²½ìš°ì—ëŠ” ë¯¼ì‚¬ì†Œì†¡ë²•ì— ë”°ë¥¸ ë²•ì›ì—ì„œì˜ ì†Œì†¡ì— ì˜í•˜ì—¬ í•´ê²°í•˜ë©°, ì œ1ì‹¬ ê´€í• ë²•ì›ì€ ê°‘ì´ ì†Œì¬í•œ ì§€ì—­ì˜ ì§€ë°©ë²•ì›ìœ¼ë¡œ í•œë‹¤.';
                }
                processedContent += disputeClause;
            }
            
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const dateString = `${year}ë…„ ${month}ì›” ${day}ì¼`;
            
            processedContent += '\n\n' + dateString;
            
            let htmlContent = processedContent.replace(/\n/g, '<br>');
            htmlContent = htmlContent.replace(/ì œ(\d+)ì¡°\s+([^<]+)/g, '<strong>ì œ$1ì¡° $2</strong>');
            
            const signatureTable = '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 40px;">' +
                '<div><table style="width: 100%; border-collapse: collapse;"><tr><td style="border: 1px solid #333; padding: 8px; font-weight: bold;">ê°‘</td><td style="border: 1px solid #333; padding: 8px;">ë‹¨ì²´</td><td style="border: 1px solid #333; padding: 8px;">' + document.getElementById('partyA').value + '(ëŒ€í‘œ ' + document.getElementById('representativeA').value + ')</td><td style="border: 1px solid #333; padding: 8px;"><div class="signature-placeholder" id="signaturePlaceA">(ê°‘ ì„œëª…)</div></td></tr><tr><td style="border: 1px solid #333; padding: 8px;">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</td><td style="border: 1px solid #333; padding: 8px;" colspan="3">' + document.getElementById('businessNumber').value + '</td></tr></table></div>' +
                '<div><table style="width: 100%; border-collapse: collapse;"><tr><td style="border: 1px solid #333; padding: 8px; font-weight: bold;">ì„</td><td style="border: 1px solid #333; padding: 8px;">ê°œì¸</td><td style="border: 1px solid #333; padding: 8px;">' + document.getElementById('partyB').value + '</td><td style="border: 1px solid #333; padding: 8px;"><div class="signature-placeholder" id="signaturePlaceB">(ì„ ì„œëª…)</div></td></tr><tr><td style="border: 1px solid #333; padding: 8px;">ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸</td><td style="border: 1px solid #333; padding: 8px;" colspan="3">' + document.getElementById('idNumber').value + '</td></tr></table></div></div>';

            return '<div class="contract-title">' + htmlContent.split('<br>')[0] + '</div>' +
                   '<div class="contract-article">' + htmlContent.substring(htmlContent.indexOf('<br>') + 4) + '</div>' +
                   signatureTable;
        }

        // ìµœì¢… ê³„ì•½ì„œ ìƒì„±
        function generateFinalContract() {
            const contractHtml = generateContractHtml();
            document.getElementById('finalContract').innerHTML = contractHtml;
        }

        // ìˆ«ìë¥¼ í•œê¸€ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
        function numberToKorean(num) {
            const units = ['', 'ì¼', 'ì´', 'ì‚¼', 'ì‚¬', 'ì˜¤', 'ìœ¡', 'ì¹ ', 'íŒ”', 'êµ¬'];
            const tens = ['', 'ì‹­', 'ë°±', 'ì²œ'];
            const tenThousands = ['', 'ë§Œ', 'ì–µ', 'ì¡°'];
            
            if (num === 0) return 'ì˜';
            
            let result = '';
            let unitIndex = 0;
            
            while (num > 0) {
                let part = num % 10000;
                if (part > 0) {
                    let partStr = '';
                    let digitIndex = 0;
                    
                    while (part > 0) {
                        let digit = part % 10;
                        if (digit > 0) {
                            if (digit === 1 && digitIndex > 0) {
                                partStr = tens[digitIndex] + partStr;
                            } else {
                                partStr = units[digit] + tens[digitIndex] + partStr;
                            }
                        }
                        part = Math.floor(part / 10);
                        digitIndex++;
                    }
                    
                    result = partStr + tenThousands[unitIndex] + result;
                }
                num = Math.floor(num / 10000);
                unitIndex++;
            }
            
            return result;
        }

        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        function setupFileUpload(uploadBox, fileInput, callback) {
            uploadBox.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    if (!file.type.match(/image\/(jpeg|jpg|png)/i)) {
                        showStatus('JPG, JPEG, PNG íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'processing');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        callback(e.target.result, file);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // ê°‘ ì„œëª… ì—…ë¡œë“œ ì²˜ë¦¬
        function handleSignatureUploadA(dataUrl, file) {
            console.log('ê°‘ ì„œëª… ì—…ë¡œë“œ ì™„ë£Œ');
            signatureDataA = dataUrl;
            const uploadBox = document.getElementById('signatureUploadA');
            uploadBox.style.borderColor = '#4caf50';
            uploadBox.style.background = '#e8f5e8';
            uploadBox.querySelector('.upload-text').textContent = 'ê°‘ ì„œëª… ì—…ë¡œë“œ ì™„ë£Œ âœ“';
            uploadBox.querySelector('.upload-subtext').textContent = file.name;
            
            showStatus('ê°‘ì˜ ì„œëª…ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤! ì„œëª… íƒ­ì—ì„œ ë°°ì¹˜í•˜ì„¸ìš”.', 'success');
            
            if (document.getElementById('signatureTab').classList.contains('active')) {
                enableSignaturePlacement('A');
            }
            updateChecklist();
        }

        // ì„ ì„œëª… ì—…ë¡œë“œ ì²˜ë¦¬
        function handleSignatureUploadB(dataUrl, file) {
            console.log('ì„ ì„œëª… ì—…ë¡œë“œ ì™„ë£Œ');
            signatureDataB = dataUrl;
            const uploadBox = document.getElementById('signatureUploadB');
            uploadBox.style.borderColor = '#4caf50';
            uploadBox.style.background = '#e8f5e8';
            uploadBox.querySelector('.upload-text').textContent = 'ì„ ì„œëª… ì—…ë¡œë“œ ì™„ë£Œ âœ“';
            uploadBox.querySelector('.upload-subtext').textContent = file.name;
            
            showStatus('ì„ì˜ ì„œëª…ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤! ì„œëª… íƒ­ì—ì„œ ë°°ì¹˜í•˜ì„¸ìš”.', 'success');
            
            if (document.getElementById('signatureTab').classList.contains('active')) {
                enableSignaturePlacement('B');
            }
        }

        // ì„œëª… ë°°ì¹˜ í™œì„±í™”
        function enableSignaturePlacement(party) {
            console.log('ì„œëª… ë°°ì¹˜ í™œì„±í™”:', party);
            
            const findAndEnablePlaceholder = () => {
                const placeholder = document.getElementById('signaturePlace' + party);
                console.log('Placeholder ì°¾ê¸°:', placeholder);
                
                if (placeholder) {
                    if (placeholder.dataset.enabled === 'true') {
                        console.log('ì´ë¯¸ í™œì„±í™”ëœ placeholder:', party);
                        return;
                    }
                    
                    placeholder.style.cursor = 'pointer';
                    placeholder.style.backgroundColor = '#fff3cd';
                    placeholder.style.border = '2px dashed #ffc107';
                    placeholder.innerHTML = (party === 'A' ? 'ê°‘' : 'ì„') + ' ì„œëª… ë°°ì¹˜ (í´ë¦­í•˜ì„¸ìš”)';
                    placeholder.dataset.enabled = 'true';
                    
                    placeholder.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('ì„œëª… ë°°ì¹˜ í´ë¦­ë¨:', party);
                        placeSignature(party, placeholder);
                    });
                    
                    console.log('ì„œëª… ë°°ì¹˜ ì¤€ë¹„ ì™„ë£Œ:', party);
                } else {
                    console.log('Placeholderë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ, ì¬ì‹œë„ ì¤‘...');
                    setTimeout(findAndEnablePlaceholder, 300);
                }
            };
            
            if (document.getElementById('signatureTab').classList.contains('active')) {
                setTimeout(findAndEnablePlaceholder, 100);
            } else {
                findAndEnablePlaceholder();
            }
        }

        // ì„œëª… ë°°ì¹˜
        function placeSignature(party, placeholder) {
            console.log('ì„œëª… ë°°ì¹˜ ì‹¤í–‰:', party);
            const signatureData = party === 'A' ? signatureDataA : signatureDataB;
            if (!signatureData) {
                console.log('ì„œëª… ë°ì´í„° ì—†ìŒ:', party);
                return;
            }
            
            const existingSignature = party === 'A' ? currentSignatureA : currentSignatureB;
            if (existingSignature) {
                existingSignature.remove();
            }
            
            const signatureOverlay = document.createElement('div');
            signatureOverlay.className = 'signature-overlay';
            signatureOverlay.style.position = 'absolute';
            signatureOverlay.style.width = '120px';
            signatureOverlay.style.height = '60px';
            signatureOverlay.setAttribute('data-party', party);
            
            const signatureImg = document.createElement('img');
            signatureImg.src = signatureData;
            signatureImg.className = 'signature-image';
            
            signatureOverlay.appendChild(signatureImg);
            
            const documentCanvas = document.getElementById('documentCanvas');
            const placeholderRect = placeholder.getBoundingClientRect();
            const canvasRect = documentCanvas.getBoundingClientRect();
            
            signatureOverlay.style.left = (placeholderRect.left - canvasRect.left + documentCanvas.scrollLeft + 10) + 'px';
            signatureOverlay.style.top = (placeholderRect.top - canvasRect.top + documentCanvas.scrollTop + 10) + 'px';
            
            documentCanvas.appendChild(signatureOverlay);
            
            if (party === 'A') {
                currentSignatureA = signatureOverlay;
            } else {
                currentSignatureB = signatureOverlay;
            }
            
            makeDraggable(signatureOverlay);
            
            placeholder.innerHTML = (party === 'A' ? 'ê°‘' : 'ì„') + ' ì„œëª… ì™„ë£Œ âœ“';
            placeholder.style.background = '#d4edda';
            placeholder.style.color = '#155724';
            placeholder.style.border = '2px solid #28a745';
            
            showStatus((party === 'A' ? 'ê°‘' : 'ì„') + 'ì˜ ì„œëª…ì´ ë°°ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            
            if (party === 'A') {
                updateChecklist();
            }
            
            console.log('ì„œëª… ë°°ì¹˜ ì™„ë£Œ:', party);
        }

        // ë“œë˜ê·¸ ê¸°ëŠ¥
        function makeDraggable(element) {
            let isDragging = false;
            let startX, startY, initialX, initialY;
            
            element.addEventListener('mousedown', function(e) {
                isDragging = true;
                selectedSignature = element;
                element.classList.add('selected');
                
                startX = e.clientX;
                startY = e.clientY;
                initialX = parseInt(element.style.left);
                initialY = parseInt(element.style.top);
                
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                
                element.style.left = (initialX + deltaX) + 'px';
                element.style.top = (initialY + deltaY) + 'px';
            });
            
            document.addEventListener('mouseup', function() {
                isDragging = false;
                if (selectedSignature) {
                    selectedSignature.classList.remove('selected');
                }
            });
        }

        // ì˜ìˆ˜ì¦ í•„ë“œ ìë™ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateReceiptFields() {
            const partyB = document.getElementById('partyB').value;
            const idNumber = document.getElementById('idNumber').value;
            const addressB = document.getElementById('addressB').value;
            const contactB = document.getElementById('contactB').value;
            
            if (partyB) document.getElementById('accountHolder').value = partyB;
            if (idNumber) document.getElementById('accountHolderID').value = idNumber;
            if (addressB) document.getElementById('accountHolderAddress').value = addressB;
            if (contactB) document.getElementById('accountHolderPhone').value = contactB;
        }

        function generateReceipt() {
            const eventName = document.getElementById('eventName').value;
            const totalAmount = document.getElementById('totalAmount').value;
            const netAmount = document.getElementById('netAmount').value;
            const bankName = document.getElementById('bankName').value;
            const accountNumber = document.getElementById('accountNumber').value;
            const accountHolder = document.getElementById('accountHolder').value;
            const accountHolderID = document.getElementById('accountHolderID').value;
            const accountHolderAddress = document.getElementById('accountHolderAddress').value;
            const accountHolderPhone = document.getElementById('accountHolderPhone').value;

            const receiptHtml = '<div class="receipt-title">' + eventName + ' ì‚¬ë¡€ë¹„ ì²­êµ¬ ì˜ìˆ˜ì¦</div>' +
                '<div style="margin-bottom: 30px;"><strong>1. ì‚¬ë¡€ë¹„ ì§€ê¸‰ ê°œìš”</strong></div>' +
                '<table class="receipt-table">' +
                '<tr><th style="width: 50px;">1.</th><th style="width: 100px;">ë‚´ìš©</th><td>' + eventName + '</td></tr>' +
                '<tr><th>2.</th><th>ì¼ì •</th><td>' + document.getElementById('startDate').value + ' - ' + document.getElementById('endDate').value + '</td></tr>' +
                '<tr><th>3.</th><th>ì¥ì†Œ</th><td>' + document.getElementById('venue').value + '</td></tr>' +
                '<tr><th>4.</th><th>ì£¼ìµœ</th><td>' + document.getElementById('partyA').value + '</td></tr>' +
                '<tr><th>7.</th><th>ì‚¬ë¡€ë¹„</th><td>ê¸ˆ ' + numberToKorean(unformatNumber(totalAmount)) + 'ì› (' + totalAmount + ')</td></tr>' +
                '</table>' +
                '<div style="margin: 30px 0;"><strong>2. ì‚¬ë¡€ë¹„ ì§€ê¸‰ì²˜</strong></div>' +
                '<table class="receipt-table">' +
                '<tr><th style="width: 50px;">1.</th><th style="width: 100px;">ì…ê¸ˆì€í–‰</th><td>' + bankName + '</td></tr>' +
                '<tr><th>2.</th><th>ê³„ì¢Œë²ˆí˜¸</th><td>' + accountNumber + '</td></tr>' +
                '<tr><th>3.</th><th>ì˜ˆê¸ˆì£¼ ì„±ëª…</th><td>' + accountHolder + '</td></tr>' +
                '<tr><th>4.</th><th>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸</th><td>' + accountHolderID + '</td></tr>' +
                '<tr><th>5.</th><th>ì£¼ì†Œ</th><td>' + accountHolderAddress + '</td></tr>' +
                '<tr><th>6.</th><th>ì „í™”ë²ˆí˜¸</th><td>' + accountHolderPhone + '</td></tr>' +
                '<tr><th>7.</th><th>ì‹¤ ì§€ê¸‰ì•¡</th><td>ê¸ˆ ' + numberToKorean(unformatNumber(netAmount)) + 'ì› (' + netAmount + ')</td></tr>' +
                '</table>' +
                '<div class="receipt-note">â€¢ ê°œì¸ì •ë³´ ì…ë ¥ ì‹œ ì„¸ë¬´/íšŒê³„ë“±ìœ¼ë¡œë§Œ ì´ìš©í•˜ë©° ìš©ë„ë¥¼ ë‹¤í•œ ì •ë³´ëŠ” ëª¨ë‘ íŒŒê¸°í•©ë‹ˆë‹¤.</div>';

            document.getElementById('receiptPreview').innerHTML = receiptHtml;
            showStatus('ì˜ìˆ˜ì¦ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // ì˜ìˆ˜ì¦ PDF ë‹¤ìš´ë¡œë“œ (ì™„ì „íˆ ìƒˆë¡œ ì‘ì„±)
        function downloadReceiptPDF() {
            const receiptPreview = document.getElementById('receiptPreview');
            if (!receiptPreview.innerHTML.trim()) {
                showStatus('ë¨¼ì € ì˜ìˆ˜ì¦ì„ ìƒì„±í•´ì£¼ì„¸ìš”.', 'processing');
                return;
            }
            
            showStatus('ì˜ìˆ˜ì¦ PDF ë‹¤ìš´ë¡œë“œë¥¼ ì¤€ë¹„í•˜ëŠ” ì¤‘...', 'processing');
            
            const printWindow = window.open('', '_blank');
            const receiptContent = receiptPreview.innerHTML;
            
            const printHTML = '\n                <!DOCTYPE html>\n                <html>\n                <head>\n                    <meta charset="UTF-8">\n                    <title>ì˜ìˆ˜ì¦</title>\n                    <style>\n                        @page {\n                            size: A4;\n                            margin: 20mm;\n                        }\n                        \n                        body {\n                            font-family: \'Malgun Gothic\', \'Apple SD Gothic Neo\', sans-serif;\n                            font-size: 11pt;\n                            line-height: 1.6;\n                            color: black;\n                            margin: 0;\n                            padding: 20px;\n                        }\n                        \n                        .receipt-title {\n                            text-align: center;\n                            font-size: 18pt;\n                            font-weight: bold;\n                            margin-bottom: 30px;\n                            border-bottom: 2px solid #333;\n                            padding-bottom: 10px;\n                        }\n                        \n                        .receipt-table {\n                            width: 100%;\n                            border-collapse: collapse;\n                            margin-bottom: 20px;\n                        }\n                        \n                        .receipt-table th,\n                        .receipt-table td {\n                            border: 1px solid #333;\n                            padding: 8px;\n                            text-align: left;\n                            font-size: 10pt;\n                        }\n                        \n                        .receipt-table th {\n                            background: #f5f5f5;\n                            font-weight: bold;\n                            text-align: center;\n                        }\n                        \n                        .receipt-note {\n                            margin-top: 30px;\n                            font-size: 9pt;\n                            color: #666;\n                        }\n                        \n                        strong {\n                            font-weight: bold;\n                            font-size: 12pt;\n                        }\n                    </style>\n                </head>\n                <body>\n                    ' + receiptContent + '\n                </body>\n                </html>\n            ';
            
            printWindow.document.open();
            printWindow.document.write(printHTML);
            printWindow.document.close();
            
            printWindow.onload = function() {
                setTimeout(() => {
                    showStatus('PDFë¡œ ì €ì¥í•˜ì‹œë ¤ë©´ ì¸ì‡„ ëŒ€í™”ìƒìì—ì„œ "PDFë¡œ ì €ì¥"ì„ ì„ íƒí•˜ì„¸ìš”.', 'success');
                    printWindow.print();
                    
                    setTimeout(() => {
                        printWindow.close();
                    }, 3000);
                }, 500);
            };
        }

        // ì „ì†¡ìš© íŒŒì¼ ìƒì„± (ì™„ì „ ìˆ˜ì • - ì•ˆì „í•œ ë¬¸ìì—´ ë°©ì‹)
        function generateExportFile() {
            if (!currentSignatureA) {
                showStatus('ë¨¼ì € ê°‘ì˜ ì„œëª…ì„ ì—…ë¡œë“œí•˜ê³  ë°°ì¹˜í•´ì£¼ì„¸ìš”.', 'processing');
                return;
            }

            showStatus('ì „ì†¡ìš© HTML íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ì¤‘...', 'processing');

            try {
                let htmlContent = document.documentElement.outerHTML;
                
                const sigA_data = signatureDataA;
                const sigA_element = currentSignatureA;
                const documentCanvas = document.getElementById('documentCanvas');
                const finalContract = document.getElementById('finalContract');
                
                const contractRect = finalContract.getBoundingClientRect();
                const sigARect = sigA_element.getBoundingClientRect();
                
                const sigA_relativePosition = {
                    left: Math.round(sigARect.left - contractRect.left),
                    top: Math.round(sigARect.top - contractRect.top),
                    width: parseInt(sigA_element.style.width) || 120,
                    height: parseInt(sigA_element.style.height) || 60,
                    opacity: parseFloat(sigA_element.style.opacity) || 1
                };

                const readOnlyFieldsScript = [
                    '    const readOnlyFields = ["partyA", "representativeA", "businessNumber", "contactA", "addressA", "eventName", "venue", "startDate", "endDate", "role", "content", "totalAmount", "taxRate"];',
                    '    readOnlyFields.forEach(fieldId => {',
                    '        const field = document.getElementById(fieldId);',
                    '        if (field) {',
                    '            field.setAttribute("readonly", "readonly");',
                    '            field.style.backgroundColor = "#f8f9fa";',
                    '            field.style.border = "2px solid #6c757d";',
                    '            field.style.cursor = "not-allowed";',
                    '        }',
                    '    });'
                ].join('\n');

                const enhancedSignatureScript = [
                    'const PRELOADED_SIGNATURE_A = "' + sigA_data + '";',
                    'const PRELOADED_POSITION_A = ' + JSON.stringify(sigA_relativePosition) + ';',
                    'let isRecipientMode = true;',
                    '',
                    'document.addEventListener("DOMContentLoaded", function() {',
                    '    console.log("ìˆ˜ì‹ ììš© ê³„ì•½ì„œ íŒŒì¼ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.");',
                    '',
                    readOnlyFieldsScript,
                    '',
                    '    signatureDataA = PRELOADED_SIGNATURE_A;',
                    '',
                    '    const sigUploadA = document.getElementById("signatureUploadA");',
                    '    if (sigUploadA) sigUploadA.style.display = "none";',
                    '',
                    '    const originalEnableSignaturePlacement = enableSignaturePlacement;',
                    '    enableSignaturePlacement = function(party) {',
                    '        const attemptPlaceholderSetup = () => {',
                    '            const placeholder = document.getElementById("signaturePlace" + party);',
                    '            if (placeholder && placeholder.dataset.setupComplete !== "true") {',
                    '                placeholder.style.cursor = "pointer";',
                    '                placeholder.style.backgroundColor = "#fff3cd";',
                    '                placeholder.style.border = "2px dashed #ffc107";',
                    '                placeholder.innerHTML = (party === "A" ? "ê°‘" : "ì„") + " ì„œëª… ë°°ì¹˜ (í´ë¦­í•˜ì„¸ìš”)";',
                    '                placeholder.dataset.setupComplete = "true";',
                    '                placeholder.addEventListener("click", function(e) {',
                    '                    e.preventDefault();',
                    '                    const signatureData = party === "A" ? signatureDataA : signatureDataB;',
                    '                    if (!signatureData) return;',
                    '                    const existingSig = party === "A" ? currentSignatureA : currentSignatureB;',
                    '                    if (existingSig) existingSig.remove();',
                    '                    const sigOverlay = document.createElement("div");',
                    '                    sigOverlay.className = "signature-overlay";',
                    '                    sigOverlay.style.position = "absolute";',
                    '                    if (party === "A") {',
                    '                        sigOverlay.style.left = PRELOADED_POSITION_A.left + "px";',
                    '                        sigOverlay.style.top = PRELOADED_POSITION_A.top + "px";',
                    '                        sigOverlay.style.width = PRELOADED_POSITION_A.width + "px";',
                    '                        sigOverlay.style.height = PRELOADED_POSITION_A.height + "px";',
                    '                    } else {',
                    '                        const canvas = document.getElementById("documentCanvas");',
                    '                        const canvasRect = canvas.getBoundingClientRect();',
                    '                        const placeholderRect = placeholder.getBoundingClientRect();',
                    '                        sigOverlay.style.left = (placeholderRect.left - canvasRect.left + canvas.scrollLeft) + "px";',
                    '                        sigOverlay.style.top = (placeholderRect.top - canvasRect.top + canvas.scrollTop) + "px";',
                    '                        sigOverlay.style.width = "120px";',
                    '                        sigOverlay.style.height = "60px";',
                    '                    }',
                    '                    const sigImg = document.createElement("img");',
                    '                    sigImg.src = signatureData;',
                    '                    sigImg.className = "signature-image";',
                    '                    sigOverlay.appendChild(sigImg);',
                    '                    document.getElementById("documentCanvas").appendChild(sigOverlay);',
                    '                    if (party === "A") currentSignatureA = sigOverlay; else currentSignatureB = sigOverlay;',
                    '                    makeDraggable(sigOverlay);',
                    '                    placeholder.innerHTML = (party === "A" ? "ê°‘" : "ì„") + " ì„œëª… ì™„ë£Œ âœ“";',
                    '                    placeholder.style.background = "#d4edda";',
                    '                });',
                    '            } else if (!placeholder) {',
                    '                setTimeout(attemptPlaceholderSetup, 200);',
                    '            }',
                    '        };',
                    '        attemptPlaceholderSetup();',
                    '    };',
                    '',
                    '    const originalHandleSignatureUploadB = handleSignatureUploadB;',
                    '    handleSignatureUploadB = function(dataUrl, file) {',
                    '        signatureDataB = dataUrl;',
                    '        const uploadBox = document.getElementById("signatureUploadB");',
                    '        if (uploadBox) {',
                    '            uploadBox.style.borderColor = "#4caf50";',
                    '            uploadBox.style.background = "#e8f5e8";',
                    '            uploadBox.querySelector(".upload-text").textContent = "ì„ ì„œëª… ì—…ë¡œë“œ ì™„ë£Œ âœ“";',
                    '        }',
                    '        showStatus("ì„ì˜ ì„œëª…ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!", "success");',
                    '        if (document.getElementById("signatureTab").classList.contains("active")) {',
                    '            setTimeout(() => enableSignaturePlacement("B"), 100);',
                    '        }',
                    '    };',
                    '',
                    '    const originalShowTab = showTab;',
                    '    showTab = function(tabName) {',
                    '        originalShowTab(tabName);',
                    '        if (tabName === "signature") {',
                    '            setTimeout(() => {',
                    '                if (signatureDataA && !currentSignatureA) {',
                    '                    enableSignaturePlacement("A");',
                    '                    setTimeout(() => {',
                    '                        const placeholderA = document.getElementById("signaturePlaceA");',
                    '                        if (placeholderA && placeholderA.dataset.setupComplete === "true") {',
                    '                            placeholderA.click();',
                    '                        }',
                    '                    }, 100);',
                    '                }',
                    '                if (signatureDataB) enableSignaturePlacement("B");',
                    '            }, 300);',
                    '        }',
                    '    };',
                    '',
                    '    showStatus("ê³„ì•½ì„œ ë‚´ìš©ì„ í™•ì¸í•˜ê³  ì„(ê·€í•˜)ì˜ ì •ë³´ë¥¼ ì…ë ¥í•œ í›„ ì„œëª…ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.", "success");',
                    '    showTab("info");',
                    '});'
                ].join('\n');

                htmlContent = htmlContent.replace(/<button[^>]*data-tab="export"[^>]*>.*?<\/button>/g, '');
                htmlContent = htmlContent.replace(/<div[^>]*id="exportTab"[^>]*>[\s\S]*?<\/div>(?=\s*<\/div>\s*<script)/, '');

                const scriptInsertionPoint = htmlContent.lastIndexOf('<script>');
                if (scriptInsertionPoint !== -1) {
                    htmlContent = htmlContent.slice(0, scriptInsertionPoint) + 
                                 '<script>\n' + enhancedSignatureScript + '\n</script>\n' + 
                                 htmlContent.slice(scriptInsertionPoint);
                }

                const eventName = document.getElementById('eventName').value || 'ê³„ì•½ì„œ';
                const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                const downloadLink = document.createElement('a');
                downloadLink.href = url;
                downloadLink.download = eventName + '_ì„œëª…ìš”ì²­.html';
                downloadLink.style.display = 'none';
                
                document.body.appendChild(downloadLink);
                downloadLink.click();
                
                setTimeout(() => {
                    document.body.removeChild(downloadLink);
                    URL.revokeObjectURL(url);
                }, 1000);
                
                showStatus('âœ… ì „ì†¡ìš© HTML íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ íŒŒì¼ì„ ìƒëŒ€ë°©ì—ê²Œ ì „ì†¡í•˜ì„¸ìš”.', 'success');
                
            } catch (error) {
                console.error('íŒŒì¼ ìƒì„± ì˜¤ë¥˜:', error);
                showStatus('íŒŒì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'processing');
            }
        }

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateChecklist() {
            const eventName = document.getElementById('eventName').value;
            const partyA = document.getElementById('partyA').value;
            
            if (eventName && partyA) {
                document.getElementById('checkContract').innerHTML = 'ğŸ“‹ ê³„ì•½ ì •ë³´ ì…ë ¥: <span class="status-complete">ì™„ë£Œ</span>';
            } else {
                document.getElementById('checkContract').innerHTML = 'ğŸ“‹ ê³„ì•½ ì •ë³´ ì…ë ¥: <span class="status-pending">ëŒ€ê¸°ì¤‘</span>';
            }
            
            if (currentSignatureA) {
                document.getElementById('checkSignatureA').innerHTML = 'âœï¸ ê°‘(ë³¸ì¸) ì„œëª…: <span class="status-complete">ì™„ë£Œ</span>';
            } else {
                document.getElementById('checkSignatureA').innerHTML = 'âœï¸ ê°‘(ë³¸ì¸) ì„œëª…: <span class="status-pending">ëŒ€ê¸°ì¤‘</span>';
            }
            
            const canExport = eventName && partyA && currentSignatureA;
            document.getElementById('generateExportFile').disabled = !canExport;
        }

        // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = 'status ' + type;
            statusEl.classList.remove('hidden');
            
            if (type === 'success') {
                setTimeout(function() {
                    statusEl.classList.add('hidden');
                }, 3000);
            }
        }

        // PDF ë‹¤ìš´ë¡œë“œ ê°œì„  (ì„œëª… ìœ„ì¹˜ ë¬¸ì œ ì™„ì „ í•´ê²°)
        function downloadPDF() {
            if (!currentSignatureA || !currentSignatureB) {
                showStatus('ê°‘ê³¼ ì„ì˜ ì„œëª…ì„ ëª¨ë‘ ë°°ì¹˜í•´ì£¼ì„¸ìš”.', 'processing');
                return;
            }
            
            showStatus('PDF ìƒì„±ì„ ì¤€ë¹„í•˜ëŠ” ì¤‘...', 'processing');
            
            const prepareSignaturesForPrint = () => {
                const signatureOverlays = document.querySelectorAll('.signature-overlay');
                signatureOverlays.forEach(overlay => {
                    overlay.style.display = 'none';
                });
                
                if (currentSignatureA) {
                    const placeholderA = document.getElementById('signaturePlaceA');
                    if (placeholderA) {
                        const sigImg = document.createElement('img');
                        sigImg.src = signatureDataA;
                        sigImg.style.maxWidth = '80px';
                        sigImg.style.maxHeight = '40px';
                        sigImg.style.width = 'auto';
                        sigImg.style.height = 'auto';
                        sigImg.style.display = 'inline-block';
                        sigImg.style.verticalAlign = 'middle';
                        placeholderA.innerHTML = '';
                        placeholderA.appendChild(sigImg);
                        placeholderA.style.background = 'white';
                        placeholderA.style.border = '1px solid #ccc';
                        placeholderA.style.padding = '5px';
                        placeholderA.style.textAlign = 'center';
                    }
                }
                
                if (currentSignatureB) {
                    const placeholderB = document.getElementById('signaturePlaceB');
                    if (placeholderB) {
                        const sigImg = document.createElement('img');
                        sigImg.src = signatureDataB;
                        sigImg.style.maxWidth = '80px';
                        sigImg.style.maxHeight = '40px';
                        sigImg.style.width = 'auto';
                        sigImg.style.height = 'auto';
                        sigImg.style.display = 'inline-block';
                        sigImg.style.verticalAlign = 'middle';
                        placeholderB.innerHTML = '';
                        placeholderB.appendChild(sigImg);
                        placeholderB.style.background = 'white';
                        placeholderB.style.border = '1px solid #ccc';
                        placeholderB.style.padding = '5px';
                        placeholderB.style.textAlign = 'center';
                    }
                }
            };
            
            const restoreSignaturesAfterPrint = () => {
                const signatureOverlays = document.querySelectorAll('.signature-overlay');
                signatureOverlays.forEach(overlay => {
                    overlay.style.display = 'block';
                });
                
                const placeholderA = document.getElementById('signaturePlaceA');
                if (placeholderA) {
                    placeholderA.innerHTML = 'ê°‘ ì„œëª… ì™„ë£Œ âœ“';
                    placeholderA.style.background = '#d4edda';
                    placeholderA.style.color = '#155724';
                    placeholderA.style.border = '2px solid #28a745';
                }
                
                const placeholderB = document.getElementById('signaturePlaceB');
                if (placeholderB) {
                    placeholderB.innerHTML = 'ì„ ì„œëª… ì™„ë£Œ âœ“';
                    placeholderB.style.background = '#d4edda';
                    placeholderB.style.color = '#155724';
                    placeholderB.style.border = '2px solid #28a745';
                }
            };
            
            prepareSignaturesForPrint();
            
            setTimeout(() => {
                showStatus('PDFë¡œ ì €ì¥í•˜ì‹œë ¤ë©´ ì¸ì‡„ ëŒ€í™”ìƒìì—ì„œ "PDFë¡œ ì €ì¥"ì„ ì„ íƒí•˜ì„¸ìš”.', 'success');
                
                window.print();
                
                setTimeout(() => {
                    restoreSignaturesAfterPrint();
                }, 2000);
                
            }, 500);
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('contractTemplate').value = defaultTemplate;
            
            document.querySelectorAll('.tab').forEach(function(tab) {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    showTab(tabName);
                });
            });
            
            setupFileUpload(
                document.getElementById('signatureUploadA'),
                document.getElementById('signatureFileA'),
                handleSignatureUploadA
            );
            
            setupFileUpload(
                document.getElementById('signatureUploadB'),
                document.getElementById('signatureFileB'),
                handleSignatureUploadB
            );
            
            document.getElementById('taxRate').addEventListener('input', calculateAmounts);
            
            document.getElementById('sizeSlider').addEventListener('input', function(e) {
                const size = e.target.value;
                document.getElementById('sizeValue').textContent = size + 'px';
                
                if (selectedSignature) {
                    selectedSignature.style.width = size + 'px';
                    selectedSignature.style.height = (size * 0.5) + 'px';
                }
            });
            
            document.getElementById('opacitySlider').addEventListener('input', function(e) {
                const opacity = e.target.value;
                document.getElementById('opacityValue').textContent = opacity + '%';
                
                if (selectedSignature) {
                    selectedSignature.style.opacity = opacity / 100;
                }
            });
            
            document.getElementById('removeBackground').addEventListener('click', function() {
                showStatus('ë°°ê²½ ì œê±° ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.', 'processing');
            });
            
            document.getElementById('downloadPdfBtn').addEventListener('click', function() {
                if (!currentSignatureB) {
                    showStatus('ì„ì˜ ì„œëª…ì„ ë¨¼ì € ë°°ì¹˜í•´ì£¼ì„¸ìš”.', 'processing');
                    return;
                }
                
                if (!currentSignatureA) {
                    showStatus('ê°‘ì˜ ì„œëª…ì´ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ì— ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'processing');
                    return;
                }
                
                showTab('preview');
            });
            
            calculateAmounts();
        });
    </script>
</body>
</html>